language: c
compiler:
- clang
- gcc
sudo: false
cache: ccache

# blocklist
branches:
  except:
  - development-psa
  - coverity_scan

script:
- tests/scripts/recursion.pl library/*.c
- tests/scripts/check-generated-files.sh
- tests/scripts/check-doxy-blocks.pl
- tests/scripts/check-names.sh
- tests/scripts/check-files.py
- tests/scripts/doxygen.sh
- cmake -D CMAKE_BUILD_TYPE:String="Check" .
- make
- make test
- programs/test/selftest
- OSSL_NO_DTLS=1 tests/compat.sh
- tests/ssl-opt.sh -e '\(DTLS\|SCSV\).*openssl'
- tests/scripts/test-ref-configs.pl
- tests/scripts/curves.pl
- tests/scripts/key-exchanges.pl
after_failure:
- tests/scripts/travis-log-failure.sh
env:
  global:
    - SEED=1
    - secure: "AshszDb2fIHOxYEfgIYGJi+O3YT/y80qz42M1+8KYXYwVHKR6FOTDICsOwO80aSW3fU2wVsowvppyo1SaUkvu5bx/F2vh0w0kih9xTZM1cvA1/DxNGc1BS9viXJscJ5Xl0JU6YRnb/EHqpCav63BvlSZmjWJhlVmXbDUUKTLesA="

before_install:
  # The Coverity Scan certificate-chain is missing an intermediate certificate
  - sudo curl -s -L https://entrust.com/root-certificates/entrust_l1k.cer -o /usr/local/share/ca-certificates/entrust_l1k.crt
  - sudo update-ca-certificates
  - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-certificates.crt

addons:
  apt:
    packages:
    - doxygen
    - graphviz
  coverity_scan:
    project:
      name: "ARMmbed/mbedtls"
    notification_email: simon.butcher@arm.com
    build_command_prepend:
    build_command: make
    branch_pattern: travis-coverity
